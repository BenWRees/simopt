import unittest
import math

from simopt.experiment_base import ProblemSolver, post_normalize

# Note: Tests have inherent randomness and may vary **slightly** between
#       runs/systems. To make sure these tsts still work, assertAlmostEqual
#       is used instead of assertEqual.
#       Some attributes, such as the lengths of lists, are still checked
#       with assertEqual as these should not change between runs.

class test_SSCONT1_ADAM(unittest.TestCase):
    def setUp(self):
        # Expected values
        self.expected_problem_name = "SSCONT-1"
        self.expected_solver_name = "ADAM"
        self.expected_all_recommended_xs = "[[(600, 600), (599.5000000110613, 599.5000000081036), (599.0000848587781, 599.0036855781585), (598.500233148688, 598.5283960523874), (598.0004142824321, 598.1962889559256), (597.5005732251103, 597.8765810889952), (597.0009056240991, 597.5277050755282), (597.0009056240991, 597.5277050755282)], [(600, 600), (599.5000000106548, 599.5000000069507), (598.9999793245573, 599.0073258918422), (598.4999507534643, 598.5869982260906), (597.9999369081033, 598.1837008487945), (597.4999946200007, 597.7854826371071), (597.0001798175526, 597.3569500216134), (597.0001798175526, 597.3569500216134)], [(600, 600), (599.5000000106439, 600.4999999973123), (598.0001122516425, 601.4439703205642), (597.5002662928774, 601.5451399240679), (597.000541764238, 601.6034739070757), (597.000541764238, 601.6034739070757)], [(600, 600), (599.500000010782, 599.5000000048257), (599.0000794382208, 598.9994997723954), (598.5001772433972, 598.5143649336619), (598.0003482521668, 598.0588411071055), (597.5006141233453, 597.8652770976229), (597.000958092979, 597.8274615873223), (597.000958092979, 597.8274615873223)], [(600, 600), (599.5000000108216, 600.4999999946197), (599.0001384485261, 600.9713236765305), (598.500317967374, 601.2182769831927), (598.0005232924763, 601.3940818069407), (597.5007521919945, 601.5582746713177), (597.0010282598391, 601.8000046600027), (597.0010282598391, 601.8000046600027)], [(600, 600), (599.5000000110132, 599.5000000060979), (598.9999825055289, 599.0203657389802), (598.4999610281761, 598.5362534599152), (598.0000645677142, 598.0477005399413), (597.0006560599502, 597.0778790205106), (597.0006560599502, 597.0778790205106)], [(600, 600), (599.5000000113104, 599.5000000324784), (599.0000219944855, 599.0285304279078), (598.500095037853, 598.6241906499826), (598.0000981418592, 598.1880238534483), (597.5003232253913, 597.8077081611476), (597.0009277934951, 597.4286114173113), (597.0009277934951, 597.4286114173113)], [(600, 600), (599.5000000108464, 599.5000000070715), (599.0000496244954, 599.007577540642), (598.4999905786697, 598.5577909296176), (597.9999672369455, 598.088792655785), (597.4999378361583, 597.7335799885267), (597.4999378361583, 597.7335799885267)], [(600, 600), (599.5000000116346, 599.5000000022575), (598.9997940694826, 599.0579904833044), (598.4992443011204, 598.6169396732552), (597.998643610039, 598.1550342095941), (597.4981017223334, 597.7249841407158), (596.997713328104, 597.3196267624867), (596.997713328104, 597.3196267624867)], [(600, 600), (599.5000000108854, 600.4999999113443), (598.9999355896637, 600.1564754116206), (598.4999561931775, 599.8369245005092), (598.0001133522595, 599.4965467140914), (597.5004350266794, 599.1401685856582), (597.0008392492098, 598.7431310510749), (597.0008392492098, 598.7431310510749)], [(600, 600), (599.0000000213345, 600.6866004284863), (598.5000841838547, 600.8486588872813), (598.0002716034935, 600.9691893812916), (597.5005890918198, 601.0595139677514), (597.0009986952622, 601.1153225120588), (597.0009986952622, 601.1153225120588)], [(600, 600), (599.5000000104313, 600.4999999950508), (598.999990990902, 600.4110417026862), (598.5000577275179, 600.2662104399672), (598.0001756834204, 600.1277596294746), (597.500395084572, 600.1542730748989), (597.0007281802514, 600.2869399569468), (597.0007281802514, 600.2869399569468)], [(600, 600), (599.5000000112791, 599.5000000018351), (599.0000327513774, 599.0118988049185), (598.5001376190256, 598.5797132629399), (598.0004185161645, 598.1764795105888), (597.5008865198442, 597.851566780974), (597.0014750808167, 597.5443164550323), (597.0014750808167, 597.5443164550323)], [(600, 600), (599.5000000103869, 599.5000000144962), (599.0000433443201, 599.26401140967), (597.501510928001, 599.1500270734617), (597.0023679185638, 599.2408738626414), (597.0023679185638, 599.2408738626414)], [(600, 600), (599.5000000111088, 600.4999999677493), (599.0000097120738, 600.2390153075909), (598.5000617052799, 600.1564411948478), (598.0001596488564, 600.2576052842992), (597.5003490194772, 600.4145633262618), (597.0006782229306, 600.5080247486649), (597.0006782229306, 600.5080247486649)], [(600, 600), (599.5000000120631, 599.5000000131489), (599.0001492252418, 599.0660833501383), (598.5004788657568, 598.6753021313934), (598.0009161482726, 598.248125554154), (597.5016435856525, 597.7962666878386), (597.0024736308321, 597.3554015553912), (597.0024736308321, 597.3554015553912)], [(600, 600), (599.5000000113757, 599.5000000075003), (599.0000981043689, 599.0058864037861), (598.5003212903617, 598.5516166858037), (598.000775687826, 598.184895244795), (597.501483684425, 597.862051555835), (597.0022442951306, 597.7993099899844), (597.0022442951306, 597.7993099899844)], [(600, 600), (599.5000000116654, 600.4999999922953), (598.9999503851963, 600.8754097407704), (598.499848177435, 601.1051144442068), (597.9997297602578, 601.1123725060895), (597.4996225828806, 600.9907878057016), (596.999565922172, 600.8534507732606), (596.999565922172, 600.8534507732606)], [(600, 600), (599.5000000117846, 599.5000000115681), (599.0000201598803, 599.0116569586831), (598.0005540007973, 599.0041364333231), (598.0005540007973, 599.0041364333231)], [(600, 600), (599.5000000126302, 599.5000000184016), (599.0000462714805, 599.3821946341864), (598.5001162059773, 599.4379014376166), (598.0002040320171, 599.595339892071), (597.5002852975703, 599.8588313586864), (597.0003536358878, 599.9191368937016), (597.0003536358878, 599.9191368937016)], [(600, 600), (599.500000010253, 599.500000022494), (599.000032346116, 599.0094884750536), (598.0001809535222, 598.7871779578561), (597.5002903410673, 598.887088293108), (597.0003880325191, 599.0552054524209), (597.0003880325191, 599.0552054524209)], [(600, 600), (599.5000000111002, 599.5000000034971), (598.9999784710172, 598.9993710019653), (598.5001235735064, 598.5555128985612), (598.0004320032923, 598.174766702132), (597.5009549995692, 597.7992136404927), (597.0017068049181, 597.5641447749147), (597.0017068049181, 597.5641447749147)], [(600, 600), (599.5000000114746, 599.5000000030157), (599.0000166807193, 599.0030113858919), (598.500069405366, 598.5842884702388), (598.0002225871689, 598.2153224236916), (597.5004918906191, 597.8747779948851), (597.0008791004526, 597.5442298566434), (597.0008791004526, 597.5442298566434)], [(600, 600), (599.5000000114627, 600.4999999969338), (599.0000000229251, 600.9995406868077), (598.5000135908006, 601.3638929109288), (598.0000089445437, 601.547599710208), (597.000177849325, 601.4991830082521), (597.000177849325, 601.4991830082521)]]"
        self.expected_all_intermediate_budgets = "[[0, 180, 330, 480, 630, 780, 930, 1000], [0, 180, 330, 480, 630, 780, 930, 1000], [0, 180, 630, 780, 930, 1000], [0, 180, 330, 480, 630, 780, 930, 1000], [0, 180, 330, 480, 630, 780, 930, 1000], [0, 180, 330, 480, 630, 930, 1000], [0, 180, 330, 480, 630, 780, 930, 1000], [0, 180, 330, 480, 630, 780, 1000], [0, 180, 330, 480, 630, 780, 930, 1000], [0, 180, 330, 480, 630, 780, 930, 1000], [0, 330, 480, 630, 780, 930, 1000], [0, 180, 330, 480, 630, 780, 930, 1000], [0, 180, 330, 480, 630, 780, 930, 1000], [0, 180, 330, 780, 930, 1000], [0, 180, 330, 480, 630, 780, 930, 1000], [0, 180, 330, 480, 630, 780, 930, 1000], [0, 180, 330, 480, 630, 780, 930, 1000], [0, 180, 330, 480, 630, 780, 930, 1000], [0, 180, 330, 630, 1000], [0, 180, 330, 480, 630, 780, 930, 1000], [0, 180, 330, 630, 780, 930, 1000], [0, 180, 330, 480, 630, 780, 930, 1000], [0, 180, 330, 480, 630, 780, 930, 1000], [0, 180, 330, 480, 630, 930, 1000]]"
        self.expected_all_est_objectives = "[[618.5809976153716, 618.531757149935, 618.1283744102988, 617.6994108978113, 617.3382879798855, 616.9234623271001, 616.8273343936545, 616.8273343936545], [619.371245290233, 618.4090044791473, 618.1921734669342, 617.8733569055988, 617.56288464254, 617.2687985789329, 616.8349930886011, 616.8349930886011], [620.2040298994102, 620.3298105858942, 619.9558807673388, 619.7806561682831, 619.6565552416639, 619.6565552416639], [620.3929887875448, 619.9074934621298, 619.6409871932873, 618.9013254496462, 618.5994949688534, 618.2842032593941, 618.0442396902184, 618.0442396902184], [617.140803174291, 616.7666205278667, 616.8475687559796, 616.7215383518055, 616.4955778007785, 616.0258010406919, 615.8111142751699, 615.8111142751699], [617.6250759903628, 617.5791502039027, 617.287224563433, 617.0000910692144, 616.9688138482924, 616.3161545013147, 616.3161545013147], [622.8299886318688, 622.4531513499861, 622.1881268669069, 622.3171551557701, 621.9735655078604, 622.0033367354589, 621.8159738691305, 621.8159738691305], [617.1638109984892, 617.0750675759077, 616.9412611383488, 616.3221502243505, 615.9220089162174, 615.6127552567112, 615.6127552567112], [625.4509909440814, 625.4068859122034, 624.9020879871041, 624.3509920652422, 623.4957096944308, 623.1151937020346, 622.6399022742665, 622.6399022742665], [616.3517529689802, 616.6000497968287, 615.9213241724925, 615.8908618237317, 615.1410630285519, 614.714221406568, 614.4575096177534, 614.4575096177534], [620.885724515664, 620.120917292083, 619.9788688486849, 619.679647962764, 619.6629083283815, 619.4670921909088, 619.4670921909088], [618.8018614763591, 618.7587156883706, 618.4986949711233, 618.2122338277123, 617.9871890511218, 617.7777284839534, 617.557181896972, 617.557181896972], [619.9876951863847, 619.6241249574779, 619.4424806653511, 619.2504839681689, 619.0817613134338, 618.7418009285278, 618.487667177016, 618.487667177016], [620.5752955225382, 620.1959612910906, 619.83198140171, 619.1151531167171, 618.92694119781, 618.92694119781], [624.383736629565, 624.1874024496384, 623.9327750050186, 623.6526153897144, 623.5015113701913, 623.2494950314559, 623.0920961625443, 623.0920961625443], [621.6851306868389, 621.448605724065, 621.1255924061796, 620.7379779746111, 620.593376062593, 620.3709809470515, 619.9496498792182, 619.9496498792182], [619.7087176057688, 619.2157181125277, 619.2481266751151, 618.6266587887069, 618.2126564579993, 617.7644744583719, 617.5519496909351, 617.5519496909351], [623.808754566687, 623.3634581025555, 623.2929727511272, 623.2653431470524, 623.039389663507, 622.8063793721897, 622.3669873592413, 622.3669873592413], [618.1205002744614, 617.6889296791536, 617.4461244900666, 616.9949052453279, 616.9949052453279], [621.6456203016469, 620.9908850771347, 620.6668407913712, 620.5522186952829, 620.391988338071, 620.503394275081, 620.3139130639224, 620.3139130639224], [617.7541201292993, 617.3654163815339, 616.5169056468361, 615.7686074159637, 615.6724880633602, 615.9482085431144, 615.9482085431144], [626.0524700155847, 625.6698957652775, 624.9380613851027, 624.836226259943, 624.382148704871, 623.8591245890261, 623.8140920864143, 623.8140920864143], [616.5518744333754, 615.9605194657425, 615.9298623830568, 615.5457175365513, 615.5060723499699, 615.3292659599706, 614.8166188326246, 614.8166188326246], [619.165760431194, 619.0942704392005, 619.0377239921737, 618.9031917169033, 618.5377569602186, 618.1594068014475, 618.1594068014475]]"
        self.expected_objective_curves = "[([0, 180, 330, 480, 630, 780, 930, 1000], [624.4131899421741, 618.531757149935, 618.1283744102988, 617.6994108978113, 617.3382879798855, 616.9234623271001, 616.8273343936545, 616.8273343936545]), ([0, 180, 330, 480, 630, 780, 930, 1000], [624.4131899421741, 618.4090044791473, 618.1921734669342, 617.8733569055988, 617.56288464254, 617.2687985789329, 616.8349930886011, 616.8349930886011]), ([0, 180, 630, 780, 930, 1000], [624.4131899421741, 620.3298105858942, 619.9558807673388, 619.7806561682831, 619.6565552416639, 619.6565552416639]), ([0, 180, 330, 480, 630, 780, 930, 1000], [624.4131899421741, 619.9074934621298, 619.6409871932873, 618.9013254496462, 618.5994949688534, 618.2842032593941, 618.0442396902184, 618.0442396902184]), ([0, 180, 330, 480, 630, 780, 930, 1000], [624.4131899421741, 616.7666205278667, 616.8475687559796, 616.7215383518055, 616.4955778007785, 616.0258010406919, 615.8111142751699, 615.8111142751699]), ([0, 180, 330, 480, 630, 930, 1000], [624.4131899421741, 617.5791502039027, 617.287224563433, 617.0000910692144, 616.9688138482924, 616.3161545013147, 616.3161545013147]), ([0, 180, 330, 480, 630, 780, 930, 1000], [624.4131899421741, 622.4531513499861, 622.1881268669069, 622.3171551557701, 621.9735655078604, 622.0033367354589, 621.8159738691305, 621.8159738691305]), ([0, 180, 330, 480, 630, 780, 1000], [624.4131899421741, 617.0750675759077, 616.9412611383488, 616.3221502243505, 615.9220089162174, 615.6127552567112, 615.6127552567112]), ([0, 180, 330, 480, 630, 780, 930, 1000], [624.4131899421741, 625.4068859122034, 624.9020879871041, 624.3509920652422, 623.4957096944308, 623.1151937020346, 622.6399022742665, 622.6399022742665]), ([0, 180, 330, 480, 630, 780, 930, 1000], [624.4131899421741, 616.6000497968287, 615.9213241724925, 615.8908618237317, 615.1410630285519, 614.714221406568, 623.0835454380884, 623.0835454380884]), ([0, 330, 480, 630, 780, 930, 1000], [624.4131899421741, 620.120917292083, 619.9788688486849, 619.679647962764, 619.6629083283815, 619.4670921909088, 619.4670921909088]), ([0, 180, 330, 480, 630, 780, 930, 1000], [624.4131899421741, 618.7587156883706, 618.4986949711233, 618.2122338277123, 617.9871890511218, 617.7777284839534, 617.557181896972, 617.557181896972]), ([0, 180, 330, 480, 630, 780, 930, 1000], [624.4131899421741, 619.6241249574779, 619.4424806653511, 619.2504839681689, 619.0817613134338, 618.7418009285278, 618.487667177016, 618.487667177016]), ([0, 180, 330, 780, 930, 1000], [624.4131899421741, 620.1959612910906, 619.83198140171, 619.1151531167171, 618.92694119781, 618.92694119781]), ([0, 180, 330, 480, 630, 780, 930, 1000], [624.4131899421741, 624.1874024496384, 623.9327750050186, 623.6526153897144, 623.5015113701913, 623.2494950314559, 623.0920961625443, 623.0920961625443]), ([0, 180, 330, 480, 630, 780, 930, 1000], [624.4131899421741, 621.448605724065, 621.1255924061796, 620.7379779746111, 620.593376062593, 620.3709809470515, 619.9496498792182, 619.9496498792182]), ([0, 180, 330, 480, 630, 780, 930, 1000], [624.4131899421741, 619.2157181125277, 619.2481266751151, 618.6266587887069, 618.2126564579993, 617.7644744583719, 617.5519496909351, 617.5519496909351]), ([0, 180, 330, 480, 630, 780, 930, 1000], [624.4131899421741, 623.3634581025555, 623.2929727511272, 623.2653431470524, 623.039389663507, 622.8063793721897, 622.3669873592413, 622.3669873592413]), ([0, 180, 330, 630, 1000], [624.4131899421741, 617.6889296791536, 617.4461244900666, 616.9949052453279, 616.9949052453279]), ([0, 180, 330, 480, 630, 780, 930, 1000], [624.4131899421741, 620.9908850771347, 620.6668407913712, 620.5522186952829, 620.391988338071, 620.503394275081, 620.3139130639224, 620.3139130639224]), ([0, 180, 330, 630, 780, 930, 1000], [624.4131899421741, 617.3654163815339, 616.5169056468361, 615.7686074159637, 615.6724880633602, 615.9482085431144, 615.9482085431144]), ([0, 180, 330, 480, 630, 780, 930, 1000], [624.4131899421741, 625.6698957652775, 624.9380613851027, 624.836226259943, 624.382148704871, 623.8591245890261, 623.8140920864143, 623.8140920864143]), ([0, 180, 330, 480, 630, 780, 930, 1000], [624.4131899421741, 615.9605194657425, 615.9298623830568, 615.5457175365513, 615.5060723499699, 615.3292659599706, 614.8166188326246, 614.8166188326246]), ([0, 180, 330, 480, 630, 930, 1000], [624.4131899421741, 619.0942704392005, 619.0377239921737, 618.9031917169033, 618.5377569602186, 618.1594068014475, 618.1594068014475])]"
        self.expected_progress_curves = "[([0.0, 0.18, 0.33, 0.48, 0.63, 0.78, 0.93, 1.0], [1.0, -3.423312226814787, -3.7266886092964926, -4.0493037979197615, -4.320897383134535, -4.632879760011062, -4.705175725699794, -4.705175725699794]), ([0.0, 0.18, 0.33, 0.48, 0.63, 0.78, 0.93, 1.0], [1.0, -3.51563214421414, -3.678706568653786, -3.9184823586154525, -4.151982562696198, -4.373159022045631, -4.699415768866922, -4.699415768866922]), ([0.0, 0.18, 0.63, 0.78, 0.93, 1.0], [1.0, -2.071030898659577, -2.3522563069595672, -2.4840393501092786, -2.577373264729243, -2.577373264729243]), ([0.0, 0.18, 0.33, 0.48, 0.63, 0.78, 0.93, 1.0], [1.0, -2.3886474664464785, -2.589081693808433, -3.1453670327605736, -3.3723679189864235, -3.609492735800612, -3.7899647104060783, -3.7899647104060783]), ([0.0, 0.18, 0.33, 0.48, 0.63, 0.78, 0.93, 1.0], [1.0, -4.750837453779144, -4.689957851852336, -4.7847428893468384, -4.954683463938541, -5.307993509325164, -5.469455287163062, -5.469455287163062]), ([0.0, 0.18, 0.33, 0.48, 0.63, 0.93, 1.0], [1.0, -4.139749547546097, -4.359301194300303, -4.575248760237198, -4.598771755162447, -5.089624268726942, -5.089624268726942]), ([0.0, 0.18, 0.33, 0.48, 0.63, 0.78, 0.93, 1.0], [1.0, -0.47410724157117545, -0.6734270464248958, -0.5763873576458829, -0.8347945084700358, -0.8124041420923677, -0.9533161420688037, -0.9533161420688037]), ([0.0, 0.18, 0.33, 0.48, 0.63, 0.78, 1.0], [1.0, -4.518860374873308, -4.619493617178165, -5.085115001011141, -5.386053565344389, -5.618637281184116, -5.618637281184116]), ([0.0, 0.18, 0.33, 0.48, 0.63, 0.78, 0.93, 1.0], [1.0, 1.7473395836074526, 1.3676907951168564, 0.9532221757463738, 0.3099807919153838, 0.023802049231154792, -0.33365547141261426, -0.33365547141261426]), ([0.0, 0.18, 0.33, 0.48, 0.63, 0.78, 0.93, 1.0], [1.0, -4.876112089613185, -5.386568547900048, -5.409478693181139, -5.973387913183827, -6.294407268863019, 0.0, 0.0]), ([0.0, 0.33, 0.48, 0.63, 0.78, 0.93, 1.0], [1.0, -2.228135518104279, -2.3349674141198493, -2.56000567434768, -2.572595230677239, -2.7198647729277954, -2.7198647729277954]), ([0.0, 0.18, 0.33, 0.48, 0.63, 0.78, 0.93, 1.0], [1.0, -3.252621085131257, -3.448177654160248, -3.6636195580155677, -3.832871396306923, -3.9904026511083512, -4.156271487706202, -4.156271487706202]), ([0.0, 0.18, 0.33, 0.48, 0.63, 0.78, 0.93, 1.0], [1.0, -2.6017634563078076, -2.7383746268639997, -2.8827716416994087, -3.009664697863343, -3.2653423499435883, -3.4564714455258825, -3.4564714455258825]), ([0.0, 0.18, 0.33, 0.78, 0.93, 1.0], [1.0, -2.171696373071925, -2.4454386314441554, -2.9845513663069188, -3.1261019223606312, -3.1261019223606312]), ([0.0, 0.18, 0.33, 0.48, 0.63, 0.78, 0.93, 1.0], [1.0, 0.8301895793635807, 0.6386891867117024, 0.4279865406710719, 0.31434412041609777, 0.12480749016565441, 0.0064308350311563225, 0.0064308350311563225]), ([0.0, 0.18, 0.33, 0.48, 0.63, 0.78, 0.93, 1.0], [1.0, -1.2296066422262952, -1.4725387318885035, -1.7640560738377875, -1.872808384379242, -2.04006746367312, -2.3569424378024206, -2.3569424378024206]), ([0.0, 0.18, 0.33, 0.48, 0.63, 0.78, 0.93, 1.0], [1.0, -2.9089183715465974, -2.8845445163636234, -3.3519385337108516, -3.663301705923787, -4.000370748250722, -4.1602065290054595, -4.1602065290054595]), ([0.0, 0.18, 0.33, 0.48, 0.63, 0.78, 0.93, 1.0], [1.0, 0.21051691907643072, 0.1575062450115379, 0.13672655240202197, -0.033208706872973615, -0.20845125523935884, -0.5389095180293179, -0.5389095180293179]), ([0.0, 0.18, 0.33, 0.63, 1.0], [1.0, -4.057186520426017, -4.239795622588976, -4.579148918415203, -4.579148918415203]), ([0.0, 0.18, 0.33, 0.48, 0.63, 0.78, 0.93, 1.0], [1.0, -1.5738495173134541, -1.817556978042868, -1.9037620469436751, -2.0242682098463245, -1.9404819521904961, -2.0829871184783997, -2.0829871184783997]), ([0.0, 0.18, 0.33, 0.63, 0.78, 0.93, 1.0], [1.0, -4.300494635208285, -4.938643202054957, -5.501423876568363, -5.573713388771191, -5.366349331004614, -5.366349331004614]), ([0.0, 0.18, 0.33, 0.48, 0.63, 0.78, 0.93, 1.0], [1.0, 1.9451442240703243, 1.3947456942933723, 1.3181574597338364, 0.9766544838055123, 0.5832981286009424, 0.5494300514770178, 0.5494300514770178]), ([0.0, 0.18, 0.33, 0.48, 0.63, 0.78, 0.93, 1.0], [1.0, -5.357090523413357, -5.380147124325484, -5.66905505823204, -5.698871438820604, -5.831844116446889, -6.2173961386383505, -6.2173961386383505]), ([0.0, 0.18, 0.33, 0.48, 0.63, 0.93, 1.0], [1.0, -3.000256825512336, -3.0427843182767838, -3.1439634491324733, -3.4187998851586068, -3.7033497461241174, -3.7033497461241174])]"

        # Convert the expected values from string to their actual types
        self.expected_all_recommended_xs = eval(self.expected_all_recommended_xs, {'nan': float('nan'), 'inf': float('inf')})
        self.expected_all_intermediate_budgets = eval(self.expected_all_intermediate_budgets, {'nan': float('nan'), 'inf': float('inf')})
        self.expected_all_est_objectives = eval(self.expected_all_est_objectives, {'nan': float('nan'), 'inf': float('inf')})
        self.expected_objective_curves = eval(self.expected_objective_curves, {'nan': float('nan'), 'inf': float('inf')})
        self.expected_progress_curves = eval(self.expected_progress_curves, {'nan': float('nan'), 'inf': float('inf')})
        
        # Number of macro-replications and post-replications
        self.num_macroreps = 24
        self.num_postreps = 200

        # Setup the solver and experiment
        self.myexperiment = ProblemSolver(self.expected_solver_name, self.expected_problem_name)
        self.assertEqual(self.myexperiment.solver.name, self.expected_solver_name, "Solver name does not match (expected: " + self.expected_solver_name + ", actual: " + self.myexperiment.solver.name + ")")
        self.assertEqual(self.myexperiment.problem.name, self.expected_problem_name, "Problem name does not match (expected: " + self.expected_problem_name + ", actual: " + self.myexperiment.problem.name + ")")

    def test_run(self):
        # Check actual run results against expected
        self.myexperiment.run(n_macroreps=self.num_macroreps)
        self.assertEqual(self.myexperiment.n_macroreps, self.num_macroreps, "Number of macro-replications for problem " + self.expected_problem_name + " and solver " + self.expected_solver_name + " does not match.")
        # For each macroreplication
        for mrep in range(self.num_macroreps):
            # Check to make sure the list lengths are the same
            self.assertEqual(len(self.myexperiment.all_recommended_xs[mrep]), len(self.expected_all_recommended_xs[mrep]), "Length of recommended solutions for problem " + self.expected_problem_name + " and solver " + self.expected_solver_name + " do not match.")
            # For each list of recommended solutions
            for list in range(len(self.myexperiment.all_recommended_xs[mrep])):
                # Check to make sure the tuples are the same length
                self.assertEqual(len(self.myexperiment.all_recommended_xs[mrep][list]), len(self.expected_all_recommended_xs[mrep][list]), "Recommended solutions for problem " + self.expected_problem_name + " and solver " + self.expected_solver_name + " do not match at mrep " + str(mrep) + " and index " + str(list) + ".")
                # For each tuple of recommended solutions
                for tuple in range(len(self.myexperiment.all_recommended_xs[mrep][list])):
                    self.assertAlmostEqual(self.myexperiment.all_recommended_xs[mrep][list][tuple], self.expected_all_recommended_xs[mrep][list][tuple], 5, "Recommended solutions for problem " + self.expected_problem_name + " and solver " + self.expected_solver_name + " do not match at mrep " + str(mrep) + " and index " + str(list) + " and tuple " + str(tuple) + ".")
            # Check to make sure the list lengths are the same
            self.assertEqual(len(self.myexperiment.all_intermediate_budgets[mrep]), len(self.expected_all_intermediate_budgets[mrep]), "Length of intermediate budgets for problem " + self.expected_problem_name + " and solver " + self.expected_solver_name + " do not match.")
            # For each list of intermediate budgets
            for list in range(len(self.myexperiment.all_intermediate_budgets[mrep])):
                # Check the values in the list
                self.assertAlmostEqual(self.myexperiment.all_intermediate_budgets[mrep][list], self.expected_all_intermediate_budgets[mrep][list], 5, "Intermediate budgets for problem " + self.expected_problem_name + " and solver " + self.expected_solver_name + " do not match at mrep " + str(mrep) + " and index " + str(list) + ".")
            
    def test_post_replicate(self):
        # Simulate results from the run method
        self.myexperiment = ProblemSolver(self.expected_solver_name, self.expected_problem_name)
        self.myexperiment.n_macroreps = self.num_macroreps
        self.myexperiment.all_recommended_xs = self.expected_all_recommended_xs
        self.myexperiment.all_intermediate_budgets = self.expected_all_intermediate_budgets

        # Check actual post-replication results against expected
        self.myexperiment.post_replicate(n_postreps=self.num_postreps)
        self.assertEqual(self.myexperiment.n_postreps, self.num_postreps, "Number of post-replications for problem " + self.expected_problem_name + " and solver " + self.expected_solver_name + " does not match.")
        # For each macroreplication
        for mrep in range(self.num_macroreps):
            # Check to make sure the list lengths are the same
            self.assertEqual(len(self.myexperiment.all_est_objectives[mrep]), len(self.expected_all_est_objectives[mrep]), "Estimated objectives for problem " + self.expected_problem_name + " and solver " + self.expected_solver_name + " do not match.")
            # For each list in the estimated objectives
            for list in range(len(self.myexperiment.all_est_objectives[mrep])):
                # Check the values in the list
                self.assertAlmostEqual(self.myexperiment.all_est_objectives[mrep][list], self.expected_all_est_objectives[mrep][list], 5, "Estimated objectives for problem " + self.expected_problem_name + " and solver " + self.expected_solver_name + " do not match at mrep " + str(mrep) + " and index " + str(list) + ".")

    def test_post_normalize(self):
        # Simulate results from the post_replicate method
        self.myexperiment = ProblemSolver(self.expected_solver_name, self.expected_problem_name)
        self.myexperiment.n_macroreps = self.num_macroreps
        self.myexperiment.n_postreps = self.num_postreps
        self.myexperiment.all_recommended_xs = self.expected_all_recommended_xs
        self.myexperiment.all_intermediate_budgets = self.expected_all_intermediate_budgets
        self.myexperiment.all_est_objectives = self.expected_all_est_objectives
        self.myexperiment.has_run = True
        self.myexperiment.has_postreplicated= True
        # Check actual post-normalization results against expected
        post_normalize([self.myexperiment], n_postreps_init_opt=self.num_postreps)

        # Loop through each curve object and convert it into a tuple
        for i in range(len(self.myexperiment.objective_curves)):
            self.myexperiment.objective_curves[i] = (self.myexperiment.objective_curves[i].x_vals, self.myexperiment.objective_curves[i].y_vals)
        for i in range(len(self.myexperiment.progress_curves)):
            self.myexperiment.progress_curves[i] = (self.myexperiment.progress_curves[i].x_vals, self.myexperiment.progress_curves[i].y_vals)

        for mrep in range(self.num_macroreps):
            # Check to make sure the same number of objective curves are present
            # This should probably always be 2 (x and y)
            self.assertEqual(len(self.myexperiment.objective_curves[mrep]), len(self.expected_objective_curves[mrep]), "Number of objective curves for problem " + self.expected_problem_name + " and solver " + self.expected_solver_name + " does not match.")
            # Make sure that curves are only checked if they exist
            if (len(self.myexperiment.objective_curves[mrep]) > 0):
                # Make sure the lengths of the X and Y values are the same
                self.assertEqual(len(self.myexperiment.objective_curves[mrep][0]), len(self.expected_objective_curves[mrep][0]), "Length of X values for problem " + self.expected_problem_name + " and solver " + self.expected_solver_name + " do not match.")
                self.assertEqual(len(self.myexperiment.objective_curves[mrep][1]), len(self.expected_objective_curves[mrep][1]), "Length of Y values for problem " + self.expected_problem_name + " and solver " + self.expected_solver_name + " do not match.")
                # Check X (0) and Y (1) values
                for x_index in range(len(self.myexperiment.objective_curves[mrep][0])):
                    # If the value is NaN, make sure we're expecting NaN
                    if (math.isnan(self.myexperiment.objective_curves[mrep][0][x_index])):
                        self.assertTrue(math.isnan(self.expected_objective_curves[mrep][0][x_index]), "X values for problem " + self.expected_problem_name + " and solver " + self.expected_solver_name + " do not match at mrep " + str(mrep) + " and index " + str(x_index) + ".")
                    # Otherwise, check the value normally
                    else:
                        self.assertAlmostEqual(self.myexperiment.objective_curves[mrep][0][x_index], self.expected_objective_curves[mrep][0][x_index], 5, "X values for problem " + self.expected_problem_name + " and solver " + self.expected_solver_name + " do not match at mrep " + str(mrep) + " and index " + str(x_index) + ".")
                for y_index in range(len(self.myexperiment.objective_curves[mrep][1])):
                    # If the value is NaN, make sure we're expecting NaN
                    if (math.isnan(self.myexperiment.objective_curves[mrep][1][y_index])):
                        self.assertTrue(math.isnan(self.expected_objective_curves[mrep][1][y_index]), "Y values for problem " + self.expected_problem_name + " and solver " + self.expected_solver_name + " do not match at mrep " + str(mrep) + " and index " + str(y_index) + ".")
                    # Otherwise, check the value normally
                    else:
                        self.assertAlmostEqual(self.myexperiment.objective_curves[mrep][1][y_index], self.expected_objective_curves[mrep][1][y_index], 5, "Y values for problem " + self.expected_problem_name + " and solver " + self.expected_solver_name + " do not match at mrep " + str(mrep) + " and index " + str(y_index) + ".")
            
            # Check to make sure the same number of progress curves are present
            # This should probably always be 2 (x and y)
            self.assertEqual(len(self.myexperiment.progress_curves[mrep]), len(self.expected_progress_curves[mrep]), "Number of progress curves for problem " + self.expected_problem_name + " and solver " + self.expected_solver_name + " does not match.")
            # Make sure that curves are only checked if they exist
            if (len(self.myexperiment.progress_curves[mrep]) > 0):
                # Make sure the lengths of the X and Y values are the same
                self.assertEqual(len(self.myexperiment.progress_curves[mrep][0]), len(self.expected_progress_curves[mrep][0]), "Length of X values for problem " + self.expected_problem_name + " and solver " + self.expected_solver_name + " do not match.")
                self.assertEqual(len(self.myexperiment.progress_curves[mrep][1]), len(self.expected_progress_curves[mrep][1]), "Length of Y values for problem " + self.expected_problem_name + " and solver " + self.expected_solver_name + " do not match.")
                # Check X (0) and Y (1) values
                for x_index in range(len(self.myexperiment.progress_curves[mrep][0])):
                    # If the value is NaN, make sure we're expecting NaN
                    if (math.isnan(self.myexperiment.progress_curves[mrep][0][x_index])):
                        self.assertTrue(math.isnan(self.expected_progress_curves[mrep][0][x_index]), "X values for problem " + self.expected_problem_name + " and solver " + self.expected_solver_name + " do not match at mrep " + str(mrep) + " and index " + str(x_index) + ".")
                    # Otherwise, check the value normally
                    else:
                        self.assertAlmostEqual(self.myexperiment.progress_curves[mrep][0][x_index], self.expected_progress_curves[mrep][0][x_index], 5, "X values for problem " + self.expected_problem_name + " and solver " + self.expected_solver_name + " do not match at mrep " + str(mrep) + " and index " + str(x_index) + ".")
                for y_index in range(len(self.myexperiment.progress_curves[mrep][1])):
                    # If the value is NaN, make sure we're expecting NaN
                    if (math.isnan(self.myexperiment.progress_curves[mrep][1][y_index])):
                        self.assertTrue(math.isnan(self.expected_progress_curves[mrep][1][y_index]), "Y values for problem " + self.expected_problem_name + " and solver " + self.expected_solver_name + " do not match at mrep " + str(mrep) + " and index " + str(y_index) + ".")
                    # Otherwise, check the value normally
                    else:
                        self.assertAlmostEqual(self.myexperiment.progress_curves[mrep][1][y_index], self.expected_progress_curves[mrep][1][y_index], 5, "Y values for problem " + self.expected_problem_name + " and solver " + self.expected_solver_name + " do not match at mrep " + str(mrep) + " and index " + str(y_index) + ".")      
